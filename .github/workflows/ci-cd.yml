name: Flask CI/CD Pipeline

on:
 push:
  branches:
   - main  # ✅ Trigger when anyone pushes to the main branch

jobs:
 build-test-deploy:
  runs-on: ubuntu-latest

  steps:
  # Step 1 – Checkout code
  - name: Checkout repository
    uses: actions/checkout@v4

  # Step 2 – Set up Python
  - name: Set up Python 3.10
    uses: actions/setup-python@v5
    with:
      python-version: '3.10'

  # Step 3 – Install dependencies
  - name: Install dependencies
    working-directory: main
    run: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt

  # Step 4 – Run unit tests
  - name: Run pytest
    working-directory: main
    run: |
      pytest tests

  # Step 5 – Build Docker image
  - name: Build Docker image
    working-directory: main
    run: |
      docker build -t flask-app .

  # Step 6 – (Optional) Push to Docker Hub
  # Uncomment below if you want to upload images to Docker Hub
  # - name: Log in to Docker Hub
  #   uses: docker/login-action@v3
  #   with:
  #     username: ${{ secrets.DOCKERHUB_USERNAME }}
  #     password: ${{ secrets.DOCKERHUB_TOKEN }}
  #
  # - name: Push image to Docker Hub
  #   run: |
  #     docker tag flask-app ${{ secrets.DOCKERHUB_USERNAME }}/flask-app:latest
  #     docker push ${{ secrets.DOCKERHUB_USERNAME }}/flask-app:latest

